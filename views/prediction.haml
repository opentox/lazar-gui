.predictions
  .back
    %h1
      %img{:src=>"/images/arrow_left_float.png", :alt=>"arrow"}
        %a{:href => to('/predict')} New Prediction

  / displays all prediction results
  .overview
    %table{:width=>"100%", :cellspacing=>"1", :id=>"overview"}
      %thead
        %tr
          %caption
            %h2 Prediction Results:

      %tbody
        %tr
          %td{:id=>"compound"}
            %a{:href => to("/prediction/#{CGI.escape(@compound.uri)}/details"), :id=>"linkCompound", :target=>"details_overview"}
              %img{:src=>"#{@compound.uri}/image", :alt=>"image not available", :width=>"100"}
            %br
            %br
            %img{:src=>"/images/arrow_up_float.png", :alt=>"arrow"}
            :javascript
              $(function() {
                $("a#linkCompound").on('click', function(e) {
                  $('#iframe_overview').bPopup();
                });
              });
          - count=0
          / var for rule to load neighbours page.
          - @@neighbours_available = 1
          - @@predictions.each do |pa|
            / prediction of one model
            - pa.each do |p|
              / p.data_entries > 1 = neighbours available
              - $logger.debug "count data_entries: #{p.data_entries.length}"
              - p.data_entries.length > 1 ? @@neighbours_available = p.data_entries.length : @@neighbours_available
              %td{:class => p.data_entries[0][0]}
                %b{:class => "title"}
                  = @@prediction_models[count].title
                %br
                %br            
                  = "Result:\n"
                  %b= p.data_entries[0][0] != nil ? p.data_entries[0][0] : "No prediction result"
                %br
                  %a{:href=>"#", :title=>"", :id=>"confidence"} Confidence
                  .tooltip{:style=>"font-weight: normal; font-size: 1em; width: 50%; text-align: left;"}
                    %dt
                      Confidence
                    %dd
                      Indicates the applicability domain of a model.
                      Predictions with a high confidence can be expected to be more reliable than predictions with low confidence.
                      Confidence values may take any value between 0 and 1.
                      For most models confidence > 0.025 is a sensible (hard) cutoff to distiguish between reliable and unreliable predictions.
                  = p.data_entries[0][1].round(3)
                %br
                %a{:href=> "#tabs", :id=>"link#{count}"}
                  %img{:src=>"/images/arrow_down_float.png", :alt=>"arrow"}
                  :javascript
                    $("a#link#{count}").click(function () {
                      $(".results").show();
                      document.getElementById('tabs').focus();
                      $("#tabs").tabs({ active: "#{count}" });
                    });
              - count+=1
  
  - if @@neighbours_available > 1
    = haml :neighbours, :layout => false
  - else
    %h2
      no neighbours available             
%iframe{:id=>"iframe_overview", :name=>"details_overview", :height=>"80%", :width=>"80%", :style=>"display:none;border:0px"}            
